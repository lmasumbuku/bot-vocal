@app.route("/transcription", methods=['POST'])
def transcription():
    """ Récupère la transcription et affiche dans les logs """
    transcribed_text = request.form.get("TranscriptionText", "")
    audio_url = request.form.get("RecordingUrl", "")

    print(f"📞 Twilio a envoyé la transcription : {transcribed_text}")
    print(f"🎙️ URL de l'enregistrement : {audio_url}")  

    if not transcribed_text and audio_url:
        print("🚀 Aucun texte reçu de Twilio, transcription via OpenAI...")
        transcribed_text = transcrire_avec_openai(audio_url)

    # 🔍 Analyser la commande et extraire les plats/quantités
    commande_analysee = analyser_commande(transcribed_text)

    response = VoiceResponse()
    response.say(f"Vous avez commandé : {commande_analysee}. Merci pour votre commande !", 
                 voice='alice', language='fr-FR')

    return str(response)
