@app.route("/transcription", methods=['POST'])
def transcription():
    """ RÃ©cupÃ¨re la transcription et affiche dans les logs """
    transcribed_text = request.form.get("TranscriptionText", "")
    audio_url = request.form.get("RecordingUrl", "")

    print(f"ğŸ“© Twilio a envoyÃ© les donnÃ©es suivantes : {request.form}")  # Debug complet
    print(f"ğŸ™ï¸ URL de l'enregistrement : {audio_url}")  

    if not transcribed_text and audio_url:
        print("ğŸš€ Aucun texte reÃ§u de Twilio, transcription via OpenAI Whisper...")
        transcribed_text = transcrire_avec_openai(audio_url)

    # ğŸ” VÃ©rifier si la transcription est vide
    if not transcribed_text or transcribed_text == "Je n'ai pas compris votre commande.":
        transcribed_text = "Commande non reconnue."

    # ğŸ”Š RÃ©pondre pour Ã©viter que le bot reste muet
    response = VoiceResponse()
    response.say(f"Vous avez commandÃ© : {transcribed_text}. Merci pour votre commande !", 
                 voice='alice', language='fr-FR')

    return str(response)
